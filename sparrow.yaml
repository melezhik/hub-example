tasks:
  -
    name: main
    language: Raku
    default: true
    code: |
      for config()<tasks><multifetch><stat><> -> \i {
        say "url: {i<url>} - [{i<status>}]";
      }
    depends:
      -
        name: multifetch

  -
    name: multifetch
    language: Raku
    code: |
      if "{cache_root_dir()}/status.OK".IO ~~ :e {
        update_state %( url => config()<url>, status => "OK" );
      } else {
        update_state %( url => config()<url>, status => "FAIL" );
      }
    init: |
      task_run "fetch"
    subtasks:
      -
        name: fetch
        language: Bash
        code: |
          curl -f $(config url) && touch $cache_root_dir/status.OK
          echo $?
    hub:
      language: Raku
      code: |
        update_state %(
          list => [
              config => { url => "https://raku.org" },
              config => { url => "https://raku.land" },
              config => { url => "http://irclogs.raku.org" },
          ],
        );
